<!DOCTYPE html>
<html>

<head>
  <title>Проект "Комменты"</title>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <div class="container">
    <ul id="list" class="comments">
    </ul>
    <div class="add-form">
      <input id="name-input" type="text" class="add-form-name" placeholder="Введите ваше имя" />
      <textarea id="text-input" type="textarea" class="add-form-text" placeholder="Введите ваш коментарий"
        rows="4"></textarea>
      <div class="add-form-row">
        <button id="add-button" class="add-form-button">Написать</button>
      </div>
    </div>
  </div>
</body>
<style>
  .error {
    background-color: rgb(226, 93, 93);
  }
</style>
<script>
  "use strict";
  const buttonElement = document.getElementById("add-button");
  const inputElement = document.getElementById("name-input");
  const textareaElement = document.getElementById("text-input");
  const listElement = document.getElementById("list");
  const likesElements = document.querySelectorAll(".likes");
  const likeButtonElements = document.querySelectorAll(".like-button");

  const initEventListener = () => {
    const likeButtonElements = document.querySelectorAll(".like-button");

    likeButtonElements.forEach((el, index) => {
      el.addEventListener('click', (event) => {
        event.stopImmediatePropagation();
        if (!comments[index].isLike) {
          comments[index].like++;
          comments[index].isLike = true;
        } else {
          comments[index].like--;
          comments[index].isLike = false;
        }
        renderComments();
      })
    })
  }
  const comments = [
    {
      name: "Глеб Фокин",
      time: "12.02.22 12:18",
      comment: "Это будет первый комментарий на этой странице",
      like: 3,
      isLike: false,
    },
    {
      name: "Варвара Н.",
      time: "13.02.22 19:22",
      comment: " Мне нравится как оформлена эта страница! ❤",
      like: 75,
      isLike: false,
    }
  ]

  const renderComments = () => {
    const listElement = document.getElementById("list");
    const commentsHtml = comments.map((comment, index) => {
      return `<li class="comment">
        <div class="comment-header">
          <div class="comment-name"> ${sanitizeHtml(comment.name)}</div>
          <div> ${comment.time} </div>
        </div>
        <div class="comment-body">
          <div class="comment-text">
            ${sanitizeHtml(comment.comment)}
          </div>
        </div>
        <div class="comment-footer">
          <div class="likes">
            <span class="likes-counter">
              <div>${comment.like}</div>
            </span>
            <button class="${comment.isLike ? 'like-button -active-like' : 'like-button'}" data-index ="${index}">
            <div></div>
            </button>
          </div>
        </div>
      </li>`
    }).join('');
    listElement.innerHTML = commentsHtml;
    initEventListener();
    answerComment()
  };
  renderComments();

  buttonElement.addEventListener('click', () => {
    const oldListElement = listElement.innerHTML;
    if (inputElement.value === '' && textareaElement.value === '') {
      inputElement.style.backgroundColor = 'red';
      textareaElement.style.backgroundColor = 'red';
      return;
    } else if (inputElement.value === '') {
      inputElement.style.backgroundColor = 'red';
      return;
    } else if (textareaElement.value === ''){
      textareaElement.style.backgroundColor = 'red';
      return;
    } else {
      inputElement.style.backgroundColor = ''
      textareaElement.style.backgroundColor = ''

      let addTimeElement = new Date();
      let year = addTimeElement.getFullYear().toString().slice(-2);
      let minutes = addTimeElement.getMinutes() < 10 ? '0' + addTimeElement.getMinutes() : addTimeElement.getMinutes();
      let hours = addTimeElement.getHours() < 10 ? '0' + addTimeElement.getHours() : addTimeElement.getHours();
      let date = addTimeElement.getDate() < 10 ? '0' + addTimeElement.getDate() : addTimeElement.getDate();
      let month = addTimeElement.getMonth() < 10 ? '0' + addTimeElement.getMonth() : addTimeElement.getMonth();
      let newDate = `${date}.${month.slice(-1) + 1}.${year}
      ${hours}:${minutes}`;

      comments.push({
        name: inputElement.value,
        time: newDate,
        comment: textareaElement.value,
        like: 0,
        isLike: false,
      })

      inputElement.value = '';
      textareaElement.value = '';
    };
    renderComments(); 
  })

  function sanitizeHtml(htmlString) {
    return htmlString.replaceAll("<", "&lt;").replaceAll(">", "&gt;");
  };

  function answerComment() {
    const commentsAnswer = document.querySelectorAll('.comment');
    const formText = document.querySelector('.add-form-text');

     commentsAnswer.forEach((comment, index) => {
      comment.addEventListener('click', () => {
        formText.value = `>${comments[index].name} \n ${comments[index].comment}`
      })
    })
  }

  console.log("It works!");
</script>

</html>